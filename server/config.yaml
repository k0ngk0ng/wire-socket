# VPN Server Configuration

server:
  # HTTP server address
  address: "0.0.0.0:8080"

  # Log level: debug, info, warn, error (default: info)
  # debug - verbose logging including Gin request logs
  # info  - normal logging (default)
  # warn  - warnings and errors only
  # error - errors only (minimal output)
  log_level: "info"

  # HTTPS configuration (optional, comment out for HTTP only)
  # tls:
  #   cert_file: "/etc/letsencrypt/live/vpn.example.com/fullchain.pem"
  #   key_file: "/etc/letsencrypt/live/vpn.example.com/privkey.pem"

database:
  # SQLite database path
  path: "./vpn.db"

  # Or use PostgreSQL (uncomment below and comment out SQLite)
  # driver: "postgres"
  # dsn: "host=localhost user=vpn password=vpn dbname=vpn port=5432 sslmode=disable"

wireguard:
  # WireGuard interface name
  device_name: "wg0"

  # WireGuard mode: "kernel" (requires wireguard-tools) or "userspace" (pure Go, no dependencies)
  mode: "userspace"

  # Server listen port
  listen_port: 51820

  # VPN subnet (clients will get IPs from this range)
  subnet: "10.0.0.0/24"

  # DNS servers for clients
  dns: "1.1.1.1,8.8.8.8"

  # Server endpoint (public address that clients will connect to)
  endpoint: "vpn.example.com:51820"

  # Routes to push to clients (CIDR format)
  # NOTE: Routes can be managed via API (/api/admin/routes) and stored in database.
  # Routes in this config are DEPRECATED - use the API instead.
  # These are ADDITIONAL routes beyond the VPN subnet
  # The VPN subnet is automatically included
  # Examples:
  routes: []
    # - "192.168.1.0/24"  # Access to internal network
    # - "10.0.0.0/8"      # Access to private networks
    # - "0.0.0.0/0"       # Route ALL traffic through VPN

  # Server private key (leave empty to generate new)
  # private_key: ""

  # Server public key (will be generated from private key)
  # public_key: ""

auth:
  # JWT secret for token signing (change this in production!)
  jwt_secret: "change-this-secret-in-production"

  # Allow public user registration (default: false)
  # When false, only admin users can create new accounts via /api/admin/users
  allow_registration: false

tunnel:
  # Enable built-in WebSocket tunnel (replaces wstunnel)
  enabled: true

  # Tunnel listen address (WebSocket)
  listen_addr: "0.0.0.0:443"

  # Public hostname for clients (used to build tunnel URL)
  # The full URL will be: wss://{public_host}{path}
  public_host: "vpn.example.com"

  # Path prefix for WebSocket upgrade (useful for nginx reverse proxy)
  # Similar to wstunnel's --restrict-http-upgrade-path-prefix
  # Examples: "/", "/tunnel", "/wg", "/secret-path"
  path: "/"

  # TLS configuration for WSS (optional, for WS only leave empty)
  # tls_cert: "/etc/letsencrypt/live/vpn.example.com/fullchain.pem"
  # tls_key: "/etc/letsencrypt/live/vpn.example.com/privkey.pem"

# NAT/Forwarding configuration
# NOTE: NAT rules can be managed via API (/api/admin/nat) and stored in database.
# Rules in this config are used as fallback if database is empty.
# Use POST /api/admin/nat/apply to apply changes without restart.
nat:
  # Enable IP forwarding (sysctl net.ipv4.ip_forward=1)
  enabled: true

  # Masquerade rules - allow VPN clients to access external networks
  # Format: outbound interface for MASQUERADE
  masquerade:
    - interface: "eth0"    # Allow VPN clients to access internet/LAN via eth0
    # - interface: "wg0"   # Allow VPN clients to access another WireGuard network

  # SNAT rules - for more specific source NAT control
  # Used when you need to specify the source IP for outbound traffic
  snat: []
    # - source: "10.250.2.0/24"       # VPN client subnet
    #   destination: "192.168.250.0/24"  # Target network
    #   interface: "wg0"              # Outbound interface
    #   to_source: "192.168.250.8"    # SNAT to this IP

  # DNAT rules - port forwarding from external to VPN clients (optional)
  dnat: []
    # - interface: "eth0"             # Incoming interface
    #   protocol: "tcp"               # tcp or udp
    #   port: 8080                    # External port
    #   to_destination: "10.250.2.5:80"  # Forward to VPN client

  # TCPMSS rules - MSS clamping to prevent MTU issues
  # Useful when traffic traverses multiple links (e.g., WireGuard over WebSocket)
  tcpmss: []
    # - interface: "wg0"              # Outbound interface
    #   source: "10.233.64.0/18"      # Source CIDR
    #   mss: 1360                     # MSS value (typical: 1360 for WG over WSS)
    # - interface: "wg0"
    #   source: "100.100.0.0/16"
    #   mss: 1360
